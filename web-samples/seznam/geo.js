"use strict";var _createClass=function(){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(){var PositionWarning=function PositionWarning(e,t){_classCallCheck(this,PositionWarning),this.code=e,this.message=t,this.SUPPORT=4},h=function(t){for(var e=arguments.length,i=Array(1<e?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];i.forEach(function(e){e&&t&&t.appendChild(e)})},u=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=document.createElement(e);for(var n in t)"innerHTML"===n||"innerText"===n||"checked"===n?i[n]=t[n]:i.setAttribute(n,t[n]);return i},s=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=null,n={};try{n.detail=e,i=new CustomEvent(t,n),window.dispatchEvent(i)}catch(e){n.type=t,i=n}var o="on"+t.replace(/[^a-z]/gi);o in window&&window[o](i)},r=function(){function n(e,t,i){_classCallCheck(this,n),this.type=e,this.listener=t,this.element=i,function(t,i){for(var e=arguments.length,n=Array(2<e?e-2:0),o=2;o<e;o++)n[o-2]=arguments[o];n.forEach(function(e){return e.addEventListener(t,i)})}(this.type,this.listener,this.element)}return _createClass(n,[{key:"stop",value:function(){!function(t,i){for(var e=arguments.length,n=Array(2<e?e-2:0),o=2;o<e;o++)n[o-2]=arguments[o];n.forEach(function(e){return e.removeEventListener(t,i)})}(this.type,this.listener,this.element)}}]),n}(),e=function(){function i(e,t){_classCallCheck(this,i),this._dialog=null,this.content=null,this._parent=null,this._overlay=null,this._button=null,this._closeButton=null,this._type=t,this.server=e,this._listeners=[],this.isCreated=!1}return _createClass(i,[{key:"_clear",value:function(){for(;0!==this._listeners.length;)this._listeners[0].stop(),this._listeners.shift()}},{key:"_onClose",value:function(e){if("keyup"===e.type&&27===e.keyCode||"click"===e.type){var t="";e.target.classList&&e.target.classList.contains("szn-geo-button")&&(t="button",e.target.classList.contains("gray")&&(t="close")),this.close(t)}}},{key:"create",value:function(){var e=this;this._overlay=u("div",{class:"szn-geo-blur"}),this._button=u("button",{class:"szn-geo-button",innerHTML:"Zavřít"}),this._parent=u("div",{class:"szn-geo-dialog-root",style:"visibility: hidden;"}),this._content=u("div",{class:"szn-geo-cnt"}),this._dialog=u("div",{id:"szn-geo-dialog"}),this._closeButton=u("span",{title:"Zavřít",class:"szn-geo-close"});var t,i,n,o,s=u("link",{rel:"stylesheet",href:"https://"+this.server+"/static/css/szn-geo.css"}),a=document.querySelector("head"),r=document.body,l=u("h3",{title:"Zavřít",innerHTML:"Poskytnutí polohy",class:"szn-geo-title"}),c=u("div",{class:"szn-geo-button-cnt"});a.insertBefore(s,a.firstChild),h(this._dialog,this._closeButton,l,this._content,c),h(c,this._button),h(this._parent,this._dialog),i="szn-geo-overlay",n=(t=r).className.split(" "),o=!1,n.forEach(function(e){e===i&&(o=!0)}),o||(t.className+=" "+i),r.insertBefore(this._overlay,r.firstChild),r.insertBefore(this._parent,r.firstChild),s.onload=function(){e._resize(!0),e._setListeners(),e._parent.style.visibility="visible",e.isCreated=!0}}},{key:"_resize",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this._dialog.offsetWidth,i=this._dialog.offsetHeight,n=window.innerWidth,o=window.innerHeight,s=Math.ceil((n-t)/2),a=Math.ceil((o-i)/2);a=o-300<=i?150:Math.floor((o-i)/2),this._dialog.style.left=s+"px",this._dialog.style.top=a+"px",e&&this._listeners.push(new r("resize",this._onResize.bind(this),window))}},{key:"_onResize",value:function(){this._resize()}},{key:"_setListeners",value:function(){this._listeners.push(new r("click",this._onClose.bind(this),this._button)),this._listeners.push(new r("click",this._onClose.bind(this),this._overlay)),this._listeners.push(new r("click",this._onClose.bind(this),this._closeButton)),this._listeners.push(new r("keyup",this._onClose.bind(this),document))}},{key:"generate",value:function(){if(!this.isCreated){var e="denied"===this._type?"https://napoveda.seznam.cz/cz/seznam/nastaveni-geolokace/":"https://napoveda.seznam.cz/cz/seznam/nastaveni-geolokace/#povoleni";this.create(),this._content.innerHTML='\n\t\t\t\tNa vašem prohlížeči nemáte zapnuté polohové služby. Pro zapnutí polohových služeb využijte \n\t\t\t\t<a class="click" id="chr_denied_all" href="'+e+'" target="_blank">návod</a>.'}}},{key:"close",value:function(){var e,i,n,o,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";this.isCreated&&(this._parent.parentNode.removeChild(this._parent),this._overlay.parentNode.removeChild(this._overlay),e=document.body,i="szn-geo-overlay",n=e.className.split(" "),o="",n.forEach(function(e,t){e!==i&&(o+=t===n.length-1?e:e+" ")}),e.className=o,this._clear(),s("geoCloseDialog",{sourceElement:t}),this.isCreated=!1)}}]),i}(),n=function(){function i(e,t){_classCallCheck(this,i),this._exception=e,this._server=t,this._dialog=null,this._recognize()}return _createClass(i,[{key:"showDialog",value:function(){this._dialog&&this._dialog.generate()}},{key:"closeDialog",value:function(){this._dialog&&this._dialog.close()}},{key:"_recognize",value:function(){1===this._exception.code||2===this._exception.code?this._dialog=new e(this._server,"denied"):this._dialog=new e(this._server,"timeout")}}]),i}(),o=function(){function i(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;_classCallCheck(this,i),this._server=e,this._position=t,this.src="",this._updateSrc(),this._MINIMUM_DISTANCE=69e-5,this._INTERVAL=3e5,this._oldCoords={longitude:0,latitude:0},this._sendTime=new Date}return _createClass(i,[{key:"send",value:function(){return!(""===this._src||!this._checkDistance()&&!this._checkInterval())&&((new Image).src=this._src,this._sendTime=new Date,!0)}},{key:"_checkDistance",value:function(){var e=this._position.coords.longitude-this._oldCoords.longitude,t=this._position.coords.latitude-this._oldCoords.latitude,i=Math.sqrt(e*e+t*t);return this._oldCoords.longitude=this._position.coords.longitude,this._oldCoords.latitude=this._position.coords.latitude,i>this._MINIMUM_DISTANCE}},{key:"_checkInterval",value:function(){return(new Date).getTime()-this._sendTime.getTime()>this._INTERVAL}},{key:"_updateSrc",value:function(){this._position&&this._position.coords.latitude&&this._position.coords.longitude&&this._position.coords.accuracy&&(this._src="https://"+this._server+"/location?lat="+this._position.coords.latitude+"&lon="+this._position.coords.longitude+"&prec="+this._position.coords.accuracy+"&src=geoAPI")}},{key:"position",set:function(e){this._position=e,this._updateSrc()},get:function(){return this._position}}]),i}(),a=function(){function e(){_classCallCheck(this,e),this._userAgent=window.navigator.userAgent,this._name="Unknown",this._version="0",this._definitions=[{name:"Windows Phone",regex:/Windows ?Phone( ?(OS ?)?([0-9\._\-]+))?/i,notRegex:/(Xbox|Windows CE|Windows Mobile)/i},{name:"Windows",regex:/Windows XP/i,notRegex:/(Xbox|Phone|Windows CE|Windows Mobile)/i},{name:"Windows",regex:/Windows ?NT ?([0-9\._\-]+)?/i,notRegex:/(Xbox|Phone|Windows CE|Windows Mobile)/i},{name:"Windows",regex:/Windows/i,notRegex:/(Xbox|Phone|Windows CE|Windows Mobile)/i},{name:"iOS",regex:/iPhone ?OS ?([0-9\._\-]+)/i,notRegex:null},{name:"iOS",regex:/(iPhone)|(iPod)|(iPad).*OS ?([0-9\._\-]+)/i,notRegex:null},{name:"iOS",regex:/(iPhone)|(iPod)|(iPad)/i,notRegex:null},{name:"Mac OS",regex:/Intel ?Mac OS X ([0-9\._\-]+)/i,notRegex:null},{name:"Mac OS",regex:/(Intel ?Mac)|(Macintosh)/i,notRegex:null},{name:"Android",regex:/Android( ?[0-9\._\-]+)?/i,notRegex:null},{name:"Solaris",regex:/(Solaris)|(SunOS)/i,notRegex:null},{name:"BSD",regex:/(BSD)/i,notRegex:null},{name:"Linux",regex:/(Linux)|(X11)/i,notRegex:null}]}return _createClass(e,[{key:"detect",value:function(){var t=this;this._definitions.forEach(function(e){t._match(e.name,e.regex,e.notRegex)})}},{key:"_match",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,n=!1;(n=i?this._userAgent.match(t)&&!this._userAgent.match(i):this._userAgent.match(t))&&"Unknown"===this.name&&(this._name=e,this._version=n[1])}},{key:"isMobile",value:function(){return"iOS"===this.name||"Windows Phone"===this.name||"Android"===this.name}},{key:"name",get:function(){return this._name}},{key:"version",get:function(){return this._version}}]),e}(),t=null;(window.dot||window.DOT)&&(t=(t=window.dot?window.dot:window.DOT).getNewInstance()).cfg({service:"szngeo",host:"h.imedia.cz",canvas:!1,impress:!1,mousedown:!1,load:!1});var l=function(e){if(t&&("undefined"==typeof navigator||!navigator.permissions))switch(e){case 0:t.hit("event",{d:{action:"allow",key:"isGEOFail"}});break;case 1:t.hit("event",{d:{action:"allow",key:"isGeoRead"}});break;case 2:t.hit("event",{d:{action:"allow",key:"isGEOSave"}})}},i=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(_classCallCheck(this,i),this._geolocation=navigator.geolocation?navigator.geolocation:null,!this._geolocation)throw Error("Browser does not support navigator.geolocation!");for(var t in this._conf={showDialogs:!1,supportInterval:6e3,server:"geo.seznam.cz"},this._cookieServer=new o(this.conf.server),this._operatingSystem=new a,this.watchId=0,this._supportTimeout=null,this._exception=null,e)this.conf[t]=e[t]}return _createClass(i,[{key:"getCurrentPosition",value:function(t,i){var n=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._geolocation.getCurrentPosition(function(e){return n._locationSuccess(e,t)},function(e){return n._locationError(e,i)},e),this._supportTimeout||(this._supportTimeout=setTimeout(this._support.bind(this),this.conf.supportInterval))}},{key:"watchPosition",value:function(t,i){var n=this,e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};this._watchId=this._geolocation.watchPosition(function(e){return n._locationSuccess(e,t)},function(e){return n._locationError(e,i)},e),this._supportTimeout||(this._supportTimeout=setTimeout(this._support.bind(this),this.conf.supportInterval))}},{key:"clearWatch",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._watchId;clearTimeout(this._supportTimeout),this._geolocation.clearWatch(e)}},{key:"isAllowed",value:function(){return window.localStorage.getItem("allow")&&"true"===window.localStorage.getItem("allow")}},{key:"_locationSuccess",value:function(e,t){clearTimeout(this._supportTimeout),this._exception&&this._exception.closeDialog(),this._cookieServer.position=e,this._cookieServer.send(),l(this.isAllowed()?1:2),window.localStorage&&window.localStorage.setItem("allow","true"),t(e)}},{key:"_locationError",value:function(e,t){clearTimeout(this._supportTimeout),l(0),window.localStorage&&window.localStorage.setItem("allow","false"),this._exception&&this._exception.closeDialog(),this._exception=new n(e,this.conf.server),this.conf.showDialogs&&!this._operatingSystem.isMobile()&&this._exception.showDialog(),s("showdialog",{error:e}),t(e)}},{key:"_support",value:function(){var e=new PositionWarning(4,"Getting position takes "+this.conf.supportInterval+"s.");this._exception=new n(e,this.conf.server),this.conf.showDialogs&&this._exception.showDialog()}},{key:"conf",get:function(){return this._conf},set:function(e){for(var t in this._conf=e)this.conf[t]=e[t]}}]),i}();window.geo=new i}();